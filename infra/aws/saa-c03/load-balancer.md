### **ELB(Elastic Load Balancing)**

서버 혹은 서버셋으로 트래픽을 백엔드나 다운스트림 EC2 인스턴스 또는 서버들로 전달하는 역할을 합니다.

애플리케이션에 단일 액세스 지점(DNS) 을 노출하고 부하를 다수의 다운스트림 인스턴스로 분산하기 위해 존재합니다.

(로드 밸런서는 모든 IP에 대해 통신 가능하지만 EC2인스턴스는 로드밸런서의 보안그룹만을 허용하여 보안을 강화합니다.)

또한 다운스트림 인스턴스의 장애를 원활히 처리할 수 있습니다.

(상태 확인 메커니즘으로 어떤 인스턴스로 트래픽을 보낼 수 없는지 확인)

종류

1. CLB(클래식 로드 밸런서) : 이제 사용을 권장하지 않는 상황
2. ALB(애플리케이션 로드 밸런서)
3. NLB(네트워크 로드 밸런서)
4. GWLB(게이트웨이 로드 밸런서)

기능이 더 많은 최신의 로드밸런서를 사용하는 것을 권장합니다.

ALB

7계층(HTTP) 전용 로드 밸런서로 머신 간 다수 HTTP 애플리케이션 라우팅에 사용됩니다.

url path 를 이용한 로드밸런싱 기능

호스트 이름을 이용한 로드밸런싱 가능

쿼리스트링과 Header 기반 로드밸런싱 가능

마이크로서비스 및 컨테이너 기반 애플리케이션에 최적인 로드 밸런서

NLB

4계층(TCP&UDP) 전용 로드 밸런서로서 초당 수백만 건의 요청을 처리할 수 있습니다.

AZ 당 하나의 고정 IP 만을 가지고 있으며 각 AZ에 탄력적 IP 를 할당할 수 있습니다.

Health Check 할 때 TCP, HTTP, HTTPS 프로토콜을 사용할 수 있습니다.

GWLB

3계층(IP 패킷) 전용 로드 밸런서로서 6081번 포트의 GENEVE 프로토콜을 사용합니다.

모든 트래픽이 방화벽을 통과하게 하거나 침입 탐지 및 방지 시스템, 심층 패킷 분석 시스템 또는 일부 페이로드를 수정할 수 있지만 네트워크 레벨에서 가능합니다.

모든 사용자 트래픽을 대상 그룹 전반으로 확산합니다.

모든 트래픽은 어플라이언스로 전달되고 어플라이언스는 트래픽을 분석하고 처리합니다.

방화벽이나 침입탐지 이상이 있으면 트래픽을 드롭할 수 있습니다.

허용되면 트래픽은 GWLB 를 통과하고 애플리케이션으로 전달됩니다.

---

### **Sticky Sessions(Session Affinity)**

클라이언트가 로드 밸런서에 두번의 요청을 할 때마다 백엔드에서 동일한 인스턴스가 요청에 응답하도록 합니다.

CLB , ALB, NLB 에서 사용 가능합니다.

클라이언트가 로드 밸런서로 요청을 보낼 때 쿠키가 함께 전송되며 이 쿠키에는 스티키니스와 만료 날짜가 포함됩니다.

쿠키가 만료되면 클라이언트가 다른 EC2 인스턴스로 Redirection 됩니다.

이는 사용자가 동일한 백엔드 인스턴스에 연결되어 세션 데이터를 잃지 않도록 합니다.

쿠키에는 두가지 종류가 있습니다.

1. 애플리케이션 기반 쿠키
2. 지속 시간 기반 쿠키
3. 커스텀 쿠키

---

### Cross Zone Load Balancing

ALB 는 교차영역 로드밸런싱이 기본적으로 활성화되어 있습니다.
AZ 간 데이터 이동에 비용이 들지 않습니다.

NLB, GWLB 는 교차영역 로드밸런싱이 기본적으로 비활성화되어 있습니다.

AZ 간 데이터 이동에 비용이 발생합니다.

로드밸런서1, 로드밸런서2 에 각각 2개 8개의 EC2 인스턴스가 포함되어 있을 경우

Cross Zone Load Balancing 설정이 없다면

100개의 트래픽이 발생했을 때 로드밸런서1 에 50개, 로드밸런서2 에 50개의 트래픽이 분산되고

로드밸런서 1의 인스턴스는 각각 25개의 트래픽을 할당, 로드밸런서 2의 인스턴스는 각각 6.25개의 트래픽이 할당됩니다.

Cross Zone Load Balancing 설정이 있다면

100개의 트래픽이 발생했을 때 로드밸런서1 에 50개, 로드밸런서2 에 50개의 트래픽이 분산되고

로드밸런서 1,2 모두의 인스턴스에 각각 10개의 트래픽이 할당됩니다.